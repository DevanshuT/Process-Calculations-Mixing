<!DOCTYPE html>
<html>
    <head>
        <title>
            Single Step Processes
        </title>

        <!--Importing pre -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.2.2/math.js"></script>


        <script>

            class component {
                constructor(name, valueType, value, unit) {
                    this.name = name;
                    this.valueType = valueType;
                    this.value = value;
                    this.unit = unit;
                }
            }

            class stream {
                constructor(name, type, value, unit, numComponents) {
                    this.name = name;
                    this.type = type;
                    this.value = value;
                    this.unit = unit;
                    this.components = [];
                    this.numComponents = numComponents;
                }
                addComponent(component) {
                    this.components.push(component);
                }
            }

            var streams = [];
            var streamCount = 0;

            var defaultUnits = "kg/hr";

            function addStream() {

            }

            /* 

            function matrixMultiply(matA, matB) {
                var matA_n = matA[0].length;
                var matB_m = matB_.length;
                if (matA_n == mat_B_m) {
                    matA_m = matA.length;
                    matB_n = matB[0].lenght;
                    var matC = Array(matA_m).fill(Array(matB_n).fill(0));
                    var i, j, k;
                    for(i = 0; i < matA_n; i++) {
                        for( j = 0; j < matA_m; j++) {
                            for( k = 0; k < matB_n; k++) {
                                matC[j][k] += matA[j][i]*matB[i][k];
                            }
                        }
                    }

                    return matC;
                }

                return "ERROR: Wrong Dimensions of Matrices";
            }
            
            function matrixDeterminant(mat) {
                var mat_m = mat.length;
                var mat_n = mat[0].length;
                if (mat_m == mat_n) {
                    if (mat_m == 1) {
                        return mat[0][0];
                    }
                    else {
                        var determinant = 0;
                        var matBuffer = Array(mat_m-1).fill(Array(mat_m-1).fill(0));
                        var i, j, k, l;
                        for( i = 0; i < mat_m; i++) {
                            for ( j = 0; j < mat_n; j++) {
                                for()
                            }
                        }
                    }
                }
            }
            */
            function solveEquation() {
                
                console.log("Inside Solve Equation");

                var i;
                var j;
                var k;
                
                var materials = [];
                
                for (i = 0; i < streamCount; i++) {
                    for (j = 0; j < streams[i].numComponents; j++) {
                        if (materials.indexOf(streams[i].components[j].name) == -1) {
                            materials.push(streams[i].components[j].name);
                        }
                    }
                }

                // console.log("Materials Array formed");
                // console.log(materials);

                var myTable = [];
                var myVariables = [];
                var numVariables = 0;
                var ratioEqn = [];
                for(i = 0; i < streamCount; i++) {
                    ratioEqn[i] = [];
                }

                for (i = 0; i < materials.length; i++) {
                    var bufferMaterial = []
                    for (j = 0; j < streamCount; j++) {
                        var qty = 0;

                        for (k = 0; k < streams[j].numComponents; k++) {
                            if(streams[j].components[k].name == materials[i]) { // finding the subs in the stream, if found
                                if (streams[j].components[k].value.length == 0) {
                                    qty = String(numVariables);
                                    myVariables.push([i,j]); //[material no][stream no]
                                    numVariables += 1;
                                    //percentage composition equations
                                }                                
                                else if(streams[j].components[k].valueType == "Absolute") {
                                    if(streams[j].components[k].unit == defaultUnits) {
                                        qty = parseFloat(streams[j].components[k].value);
                                    }
                                    else {
                                        if (defaultUnits == "kg/hr") {
                                            qty = parseFloat(streams[j].components[k].value)/2.20462;
                                        }
                                        else {
                                            qty = parseFloat(streams[j].components[k].value)*2.20462;
                                        }
                                    }
                                }
                                else {
                                    if(streams[j].value.length == 0) {
                                        qty = String(numVariables);
                                        myVariables.push([i,j]); //[material no][stream no]
                                        ratioEqn[j].push([numVariables, parseFloat(streams[j].components[k].value)/100]);
                                        numVariables += 1;

                                        //percentage composition equations
                                    }
                                    else {
                                        if(streams[j].unit == defaultUnits) {
                                            qty = parseFloat(streams[j].value)*parseFloat(streams[j].components[k].value)/100;
                                        }
                                        else {
                                            if (defaultUnits == "kg/hr") {
                                                qty = parseFloat(streams[j].value)*parseFloat(streams[j].components[k].value)/(100*2.20462);
                                            }
                                            else {
                                                qty = parseFloat(streams[j].value)*parseFloat(streams[j].components[k].value)*2.20462/100;
                                            }
                                        }
                                    }
                                }
                                break;
                            }
                        }
                        bufferMaterial.push(qty);               
                    }
                    myTable.push(bufferMaterial);                    
                }

                console.log("myTable");
                console.log(myTable);

                var myMatrixA = [];
                var myMatrixB = [];
                for( i = 0; i < materials.length; i++) {
                    var bufferArr = [];
                    for( j = 0; j < numVariables; j++) {
                        bufferArr.push(0);
                    }
                    myMatrixA.push(bufferArr);
                    myMatrixB.push(0);
                }
                console.log("Populating Matrices");
                console.log("Matrix A");
                console.log(myMatrixA);
                console.log("Matrix B");
                console.log(myMatrixB);


                for(i = 0; i < materials.length; i++) {
                    
                    for(j = 0; j < streamCount; j++) {

                        console.log(String(i)+"," + String(j));
                        if(typeof myTable[i][j] === 'string') {
                            //console.log("Variable");
                            var variableID = parseInt(myTable[i][j]);
                            //console.log(variableID);
                            if(streams[j].type == "Input") {
                                myMatrixA[i][variableID] = 1;
                            }
                            else {
                                myMatrixA[i][variableID] = -1;
                            }
                        }
                        else {
                            //console.log("Value");
                            if(streams[j].type == "Input") {
                                myMatrixB[i] -= myTable[i][j];
                            }
                            else {
                                myMatrixB[i] += myTable[i][j];
                            }
                            
                        }
                    }
                }

                console.log("ratioEqn");
                console.log(ratioEqn);
                
                var bufferEqn = [];
                for( i = 0 ; i < streamCount; i++) {
                    
                    if(ratioEqn[i].length != 0) {
                        for( j = 0; j < ratioEqn[i].length - 1; j++ ) {
                            //console.log(String(i)+"," + String(j));
                            bufferEqn = [];
                            for( k = 0; k < numVariables; k++) {
                                bufferEqn.push(0);
                            }
                            //console.log("bufferEqn Array");
                            //console.log(bufferEqn);
                            var matB_value = 0;
                            for( k = 0; k < materials.length; k++) {
                                if(typeof myTable[k][i] === 'string') {
                                    var variableID = parseInt(myTable[k][i]);
                                    if(k==j) {
                                        bufferEqn[variableID] = ratioEqn[i][j][1]-1;
                                    }
                                    else {
                                        bufferEqn[variableID] = ratioEqn[i][j][1];
                                    }
                                }
                                else {
                                    matB_value -= myTable[k][i]*ratioEqn[i][j][1];
                                }
                            }
                            //console.log(bufferEqn);
                            myMatrixA.push(bufferEqn);
                            myMatrixB.push(0);
                        }
                    }
                    else if(streams[i].value.length != 0){
                        //console.log(String(i)+"," + String(j));
                        bufferEqn = [];
                        for( k = 0; k < numVariables; k++) {
                            bufferEqn.push(0);
                        }
                        //console.log("bufferEqn Array");
                        //console.log(bufferEqn);
                        var matB_value = 0;
                        var myFlag = 0;
                        for( k = 0; k < materials.length; k++) {
                            if(typeof myTable[k][i] === 'string') {
                                var variableID = parseInt(myTable[k][i]);
                                bufferEqn[variableID] = 1;
                                myFlag = 1;
                            }
                            else {
                                matB_value -= myTable[k][i];
                            }
                        }
                        if (myFlag) {
                            myMatrixA.push(bufferEqn);
                            myMatrixB.push(matB_value);
                        }
                        
                    }
                }
                /*
                console.log("Matrix A");
                console.log(myMatrixA);
                console.log("Matrix B");
                console.log(myMatrixB);
                */

                //m x n, m - rows, n - columns
                var myMatrixA_m = myMatrixA.length;
                var myMatrixA_n = numVariables;
                var myMatrixB_m = myMatrixB.length;
                //myMatrixB_n = 1


                var myMatrixX;

                if (myMatrixA_m != myMatrixB_m) { 
                    // Equations not formed properly
                    alert("Code internally corrupted");
                }
                else if (myMatrixA_m != myMatrixA_n) {
                    //
                    alert("Degree of Freedom = " + String(myMatrixA_m - myMatrixA_n));
                }
                else {
                    // Solving the matrix equations
                    myMatrixX = math.lusolve(myMatrixA, myMatrixB);
                    
                    // console.log(myMatrixX);
                    // alert("Equations successfully solved");
                    
                    var badValues = 0; // flag to check if value of flowrate of any stream is negative

                    // code to go through each calculated value and
                    // insert the values in their corresponding position
                    // in the table and
                    // update flag badValues if any calculated value
                    // is negative
                    for( i = 0; i < numVariables; i++) {
                        myTable[myVariables[i][0]][myVariables[i][1]] = myMatrixX[i];
                        if (myMatrixX[i] < 0) badValues = 1;
                    }

                    if (badValues) {
                        // if any calculated value is negative
                        alert("Degree of Freedom = 0\nBad Input Values!!");
                    }
                    else {
                        alert("Degree of Freedom = 0\nEquations successfully solved");
                    }

                    // updating the values of flowrates in the existing
                    // data structure of streams

                    for( i = 0; i < streamCount; i++) {
                        
                        // variable to calculate the total flow rate of
                        // the stream
                        var streamTotal = 0.0;

                        // updating each component of the stream
                        for( j = 0; j < streams[i].numComponents; j++) {
                            
                            // code to find the index of the current
                            // component in the list materials
                            var myFlag = -1;
                            for( k = 0; k < materials.length; k++) {
                                if(materials[k] == streams[i].components[j].name) {
                                    myFlag = k;
                                    break;
                                }
                            }

                            // myFlag now contains the index of the
                            // current component in the list materials
                            if (myFlag > -1) {

                                // inserting the flow rate values from myTable
                                streams[i].components[j].value = myTable[myFlag][i];
                                // changing the units back to what the user
                                // input was
                                if(streams[i].components[j].unit != defaultUnits) {
                                    if (defaultUnits == "kg/hr") {
                                        streams[i].components[j].value *= 2.20462;
                                    }
                                    else {
                                        streams[i].components[j].value /= 2.20462;
                                    }
                                }
                                // changing the flow rate value type to Absolute 
                                // for each component
                                streams[i].components[j].valueType = "Absolute";

                                // console.log(streams[i].components[j].valueType);

                                // updating the total flow rate of the stream
                                streamTotal += parseFloat(String(myTable[myFlag][i]));

                            }
                        }

                        // updating the total flow rate of the stream 
                        // in the streams list
                        streams[i].value = streamTotal;
                        if(streams[i].unit != defaultUnits) {
                            if (defaultUnits == "kg/hr") {
                                streams[i].value *= 2.20462;
                            }
                            else {
                                streams[i].value /= 2.20462;
                            }
                        }

                    }
                    //document.getElementById("")

                }

            }

            
        </script>

    </head>

    <body background="bg.jpg">
        <br>
        <br>
        <br>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="float-right" id="leftCol">
                        <button type="button" class="button" id="AddNewInputStreamButton" onclick="inputUpdateStream()" data-toggle="modal" data-target="#StreamModal"><b>+</b></button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="float-center">
                        <div class="card" style="width: 100%;">
                            <div class="card-body">
                                <div>
                                    <input type="text" class="form-control" placeholder="Process Name" id="processName">
                                </div>
                                <br>
                                <div>
                                    <textarea class="form-control" placeholder="Process Description" id="processDesc" rows="3"></textarea>
                                </div>
                                <br>
                                <div class="float-left">
                                    <label for="defaultUnit">Default Units</label>
                                    <div class="input-group-append">
                                        <select class="form-control" id="defaultUnit" onchange="updateDefaultUnits(this.value)">
                                            <option>kg/hr</option>
                                            <option>lb/hr</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="float-right">
                                    <button type="button" class="solveButton" onclick="solveEquation()">Solve</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="float-left" id="rightCol">
                        <button type="button" class="button" id="AddNewOutputButton" onclick="outputUpdateStream()" data-toggle="modal" data-target="#StreamModal"><b>+</b></button>
                    </div>
                </div>
            </div>
        </div>

        <!--- Modals -->
        <div id="StreamModal" class="modal fade" role="dialog">
    
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Stream</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <input type="text" class="form-control" placeholder="Stream Name" id="streamName">
                        </div>
                        <br>
                        <div>
                            <label for="streamType">Type of Stream</label>
                            <select class="form-control" id="streamType">
                                <option id="streamTypeInput">Input</option>
                                <option id="streamTypeOutput">Output</option>
                            </select>
                        </div>
                        <br>
                        <label for="Value">Total Flow Rate</label> 
                        <div class="input-group mb-3">
                            <input type="number" class="form-control" placeholder="Flow Rate" id="streamValue">
                            <div class="input-group-append">
                                <select class="form-control" id="streamUnit">
                                    <option id="kg/hr_stream">kg/hr</option>
                                    <option id="lb/hr_stream">lb/hr</option>
                                </select>
                            </div>
                        </div>
                        <div>
                                <button type="button" class="button" id="addCompBut" data-toggle="modal" data-target="#ComponentsModal"><b>+</b></button>
                        </div>
                        <div id="addCompSection">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="DeleteStreamBut">Delete</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="newStreamOK">OK</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="ComponentsModal" class="modal fade" role="dialog">
            
            <div class="modal-dialog">
            
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Components</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <input type="text" class="form-control" placeholder="Component Name" id="compName">
                        </div>
                        <br>
                        <div>
                            <label for="valueType">Type of Value</label>
                            <select class="form-control" id="valueType">
                                <option id="a">Absolute</option>
                                <option id="p">w/w %</option>
                            </select>
                        </div>
                        <br>
                        <label for="Value">Value</label> 
                        <div class="input-group mb-3" id="newCompValueDiv">
                            <input type="number" class="form-control" placeholder="Flow Rate" id="Value">
                            <div class="input-group-append">
                                <select class="form-control" id="compUnit">
                                    <option id="kg/hr_comp">kg/hr</option>
                                    <option id="lb/hr_comp">lb/hr</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="DeleteCompBut">Delete</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="newCompOK">OK</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>

                    <script>
                        
                    </script>

                </div>
            </div>
        </div>

        <script>

            var components = [];
            
            function newStream() {
                var name = document.getElementById("streamName").value;
                var type = document.getElementById("streamType").value;
                var value = document.getElementById("streamValue").value;
                var unit = document.getElementById("streamUnit").value;
                
                var numComponents = components.length;
                var newStream = new stream(name, type, value, unit, numComponents);
                for (var i = 0; i < numComponents; i++) {
                    newStream.components.push(components[i]);
                }
                components = [];

                streams.push(newStream);
                var index = streamCount;
                streamCount += 1;                                

                var newDiv = document.createElement("DIV");
                var mybutton = document.createElement("BUTTON");
                var rightArrow = document.createElement("i");
                rightArrow.setAttribute("class", "right");
                
                mybutton.setAttribute("class", "streamButton");
                mybutton.setAttribute("aria-label", "Right Align");
                mybutton.setAttribute("id",String(index)+" stream");
                mybutton.setAttribute("onclick", "updateStream(" + String(index) + ")");
                mybutton.setAttribute("data-toggle", "modal");
                mybutton.setAttribute("data-target", "#StreamModal")
                mybutton.value = name;
                mybutton.innerHTML = name;    
                
                newDiv.appendChild(mybutton);
                newDiv.innerHTML = newDiv.innerHTML + "&nbsp";
                newDiv.appendChild(rightArrow);
                newDiv.setAttribute("style", "margin-bottom:2px");
                if (type == "Input") {
                    document.getElementById("leftCol").appendChild(newDiv);
                }
                else {
                    document.getElementById("rightCol").appendChild(newDiv);
                }
                
                
                // $("#StreamModal").remove;
                // document.getElementById("streamName").value="";
            }

            function findStreamByName(name) {
                var i;
                var flag = 0;
                for(i = 0; i < streamCount; i++) {
                    if(streams[i].name == name) {
                        flag = 1;
                        break;
                    }
                }

                if (flag) return i;
                else return -1;
            }

            function modifyStream(i) {
                if (i >= 0 & i < streamCount) {
                    //streams[i].type = document.getElementById("streamType").value;
                    streams[i].value = document.getElementById("streamValue").value;
                    streams[i].unit = document.getElementById("streamUnit").value;
                    streams[i].numComponents = document.getElementById("numComponents").value;
                    while(streams[i].components.length > 0) {
                        streams[i].components.pop();
                    }
                    for (var i = 0; i < numComponents; i++) {
                        streams[i].components.push(components[i]);
                    }
                }                               
            }

            function newComp(i) {

                console.log("Inside new Comp");
                var name = document.getElementById("compName").value;
                var type = document.getElementById("valueType").value;
                var value = document.getElementById("Value").value;
                var unit = document.getElementById("compUnit").value;
                var newComp = new component(name, type, value, unit);
                
                if(i==-1) {
                    components.push(newComp);
                }
                else if(i >=0 & i < streamCount){
                    streams[i].components.push(newComp);
                }
                

                var addCompSect = document.getElementById("addCompSection");
                var newDiv = document.createElement("DIV");
                var myBut = document.createElement("BUTTON");
                myBut.setAttribute("class", "btn btn-info btn-lg");
                myBut.setAttribute("data-toggle", "modal");
                myBut.setAttribute("data-target", "#ComponentsModal");
                myBut.setAttribute("id", "Component "+String(i));
                if(i==-1) {
                    myBut.setAttribute("id", "Component "+String(components.length - 1));
                    myBut.setAttribute("onclick", "modifyCompModal(-1," + String(components.length - 1) + ")");
                }
                else if(i >=0 & i < streamCount){
                    myBut.setAttribute("id", "Component "+String(streams[i].components.length - 1));
                    myBut.setAttribute("onclick", "modifyCompModal(" + String(i) + "," + String(streams[i].components.length - 1) + ")");
                }
                myBut.innerHTML = name;
                newDiv.appendChild(myBut);
                newDiv.setAttribute("style", "margin-bottom:2px");
                addCompSect.appendChild(newDiv);
            }

            function selectStreamType(typeStr) {
                document.getElementById("streamTypeInput").removeAttribute("selected");
                document.getElementById("streamTypeOutput").removeAttribute("selected");
                if (typeStr == "Input") {
                    document.getElementById("streamTypeInput").setAttribute("selected", true);
                }
                else {
                    document.getElementById("streamTypeOutput").setAttribute("selected", true);
                }
            }

            function selectUnitStream(unitStr) {
                document.getElementById("kg/hr_stream").removeAttribute("selected");
                document.getElementById("lb/hr_stream").removeAttribute("selected");
                if (unitStr == "kg/hr") {
                    document.getElementById("kg/hr_stream").setAttribute("selected", true);
                }
                else {
                    document.getElementById("lb/hr_stream").setAttribute("selected", true);
                }
            }

            function deleteStream(i) {
                console.log(streams.length);
                
                console.log("Deleting Stream # " + String(i));
                if (i >= 0 & i < streamCount) {
                    streams.splice(i, 1);
                    streamCount = streamCount - 1;
                }
                console.log(streams.length);
                document.getElementById(String(i) + " stream").parentNode.remove();
            }

            function updateStream(i) {
                // console.log(buttonObj.id); 
                // console.log(i);
                document.getElementById("streamName").value = streams[i].name;
                document.getElementById("streamName").setAttribute("readonly", true);
                document.getElementById("streamType").setAttribute("disabled", "disabled");
                selectStreamType(streams[i].type);
                document.getElementById("streamValue").value = streams[i].value;
                selectUnitStream(streams[i].unit);
                document.getElementById("addCompBut").setAttribute("onclick", "modifyCompModal(" + String(i) + ",-1)");
                var j = 0;
                document.getElementById("addCompSection").innerHTML = "";

                for( j = 0; j < streams[i].numComponents; j++) {
                    var newDiv = document.createElement("DIV");
                    var myBut = document.createElement("BUTTON");
                    myBut.setAttribute("class", "btn btn-info btn-lg");
                    myBut.setAttribute("data-toggle", "modal");
                    myBut.setAttribute("data-target", "#ComponentsModal");
                    myBut.setAttribute("id", "Component "+ String(j));
                    myBut.setAttribute("onclick", "modifyCompModal(" + String(i) + "," + String(j) + ")");
                    myBut.innerHTML = streams[i].components[j].name;
                    newDiv.appendChild(myBut);
                    newDiv.setAttribute("style", "margin-bottom:2px");
                    document.getElementById("addCompSection").appendChild(newDiv);
                }

                document.getElementById("newStreamOK").setAttribute("onclick","modifyStream()");
                document.getElementById("DeleteStreamBut").setAttribute("onclick", "deleteStream(" + String(i) + ")");
                if (document.getElementById("DeleteStreamBut").style.display == "none") {
                    document.getElementById("DeleteStreamBut").style.display = "block";
                }
                
            }

            function inputUpdateStream() {
                console.log("in add new stream");
                selectStreamType("Input");
                document.getElementById("streamName").value = "";
                document.getElementById("streamName").removeAttribute("readonly");
                document.getElementById("streamType").removeAttribute("disabled");
                document.getElementById("streamValue").value = "";
                selectUnitStream(defaultUnits);
                document.getElementById("addCompBut").setAttribute("onclick", "modifyCompModal(-1,-1)");
                document.getElementById("addCompSection").innerHTML = "";

                document.getElementById("DeleteStreamBut").style.display = "none";
                document.getElementById("newStreamOK").setAttribute("onclick","newStream()");
                components = [];
                
            }

            function outputUpdateStream() {
                console.log("in add new stream");
                selectStreamType("Output");
                document.getElementById("streamName").value = "";
                document.getElementById("streamName").removeAttribute("readonly");
                document.getElementById("streamType").removeAttribute("disabled");
                document.getElementById("streamValue").value = "";
                selectUnitStream(defaultUnits);
                document.getElementById("addCompBut").setAttribute("onclick", "modifyCompModal(-1,-1)");
                document.getElementById("addCompSection").innerHTML = "";

                document.getElementById("DeleteStreamBut").style.display = "none";
                document.getElementById("newStreamOK").setAttribute("onclick","newStream()");
                components = [];
                
            }

            function selectCompValueType(type) {
                document.getElementById("p").removeAttribute("selected");
                document.getElementById("a").removeAttribute("selected");
                if (type == "Absolute") {
                    console.log("Absolute got selected");
                    document.getElementById("a").setAttribute("selected", true);
                }
                else {
                    console.log("w_w got selected");
                    document.getElementById("p").setAttribute("selected", true);
                }
            }

            function selectCompUnits(unitStr) {
                document.getElementById("kg/hr_comp").removeAttribute("selected");
                document.getElementById("lb/hr_comp").removeAttribute("selected");
                if (unitStr == "kg/hr") {
                    document.getElementById("kg/hr_comp").setAttribute("selected", true);
                }
                else {
                    document.getElementById("lb/hr_comp").setAttribute("selected", true);
                }
            }

            function modifyCompModal(streamID, compID) {
                console.log("Inside modify Comp Modal")
                if(streamID == -1 & compID == -1) {
                    console.log("Inside condition 1");
                    document.getElementById("compName").value = "";
                    document.getElementById("compName").removeAttribute("readonly");
                    document.getElementById("valueType").removeAttribute("disabled");
                    selectCompValueType("w_w");
                    document.getElementById("Value").value = "";
                    selectCompUnits(defaultUnits);
                    document.getElementById("DeleteCompBut").style.display = "none";
                    document.getElementById("newCompOK").setAttribute("onclick", "newComp(-1)");
                }

                else if(streamID >= 0 & streamID < streamCount & compID==-1) {
                    console.log("Inside condition 2");
                    document.getElementById("compName").value = "";
                    document.getElementById("compName").removeAttribute("readonly");
                    document.getElementById("valueType").removeAttribute("disabled");
                    selectCompValueType("w_w");
                    document.getElementById("Value").value = "";
                    selectCompUnits(defaultUnits);
                    document.getElementById("DeleteCompBut").style.display = "none";
                    document.getElementById("newCompOK").setAttribute("onclick", "newComp(" + String(streamID) + ")");
                }

                else if(streamID == -1 & compID >= 0 & compID < components.length) {
                    console.log("Inside condition 3");
                    document.getElementById("compName").value = components[compID].name;
                    document.getElementById("compName").setAttribute("readonly", true);
                    document.getElementById("valueType").setAttribute("disabled", "disabled");
                    selectCompValueType(components[compID].valueType);
                    document.getElementById("Value").value = components[compID].value;
                    selectCompUnits(components[compID].unit);
                    document.getElementById("DeleteCompBut").setAttribute("onclick", "deleteComp(-1," + String(compID) + ")");
                    if (document.getElementById("DeleteCompBut").style.display == "none") {
                        document.getElementById("DeleteCompBut").style.display = "block";
                    }
                    document.getElementById("newCompOK").setAttribute("onclick", "modifyComp(-1," + String(compID) + ")");
                }

                else if(streamID >= 0 & streamID < streamCount & compID >= 0 & compID < streams[streamID].numComponents) {
                    console.log("Inside condition 4");
                    document.getElementById("compName").value = streams[streamID].components[compID].name;
                    document.getElementById("compName").setAttribute("readonly", true);
                    document.getElementById("valueType").setAttribute("disabled", "disabled");
                    selectCompValueType(streams[streamID].components[compID].valueType);
                    //console.log(streams[streamID].components[compID].valueType);
                    document.getElementById("Value").value = streams[streamID].components[compID].value;
                    selectCompUnits(streams[streamID].components[compID].unit);
                    document.getElementById("DeleteCompBut").setAttribute("onclick", "deleteComp(" + String(streamID) + "," + String(compID) + ")");
                    if (document.getElementById("DeleteCompBut").style.display == "none") {
                        document.getElementById("DeleteCompBut").style.display = "block";
                    }
                    document.getElementById("newCompOK").setAttribute("onclick", "modifyComp(" + String(streamID) + "," + String(compID) + ")");
                    
                }
            }

            function deleteComp(streamID, compID) {
                // console.log("Inside Delete");
                if(streamID == -1 & compID >= 0 & compID < components.length) {
                    document.getElementById("Component " + String(compID)).parentNode.remove();
                    components.splice(compID, 1);
                }                
                else if(streamID >= 0 & streamID < streamCount & compID >= 0 & compID < streams[streamID].numComponents) {
                    document.getElementById("Component " + String(compID)).parentNode.remove();
                    streams[streamID].components.splice(compID, 1);
                }
            }

            function modifyComp(streamID, compID) {
                // console.log("Inside Delete");
                if(streamID == -1 & compID >= 0 & compID < components.length) {    
                    // console.log("Inside new Comp");
                    // var name = document.getElementById("compName").value;
                    // var type = document.getElementById("valueType").value;
                    components[compID].value = document.getElementById("Value").value;
                    components[compID].unit = document.getElementById("compUnit").value;
                    // components[compID] = new component(name, type, value, unit);
                }                
                else if(streamID >= 0 & streamID < streamCount & compID >= 0 & compID < streams[streamID].numComponents) {
                    // var name = document.getElementById("compName").value;
                    // var type = document.getElementById("valueType").value;
                    streams[streamID].components[compID].value = document.getElementById("Value").value;
                    streams[streamID].components[compID].unit = document.getElementById("compUnit").value;
                    // streams[streamID].components[compID] = new component(name, type, value, unit);
                }
            }

            function updateDefaultUnits(unitStr) {
                defaultUnits = unitStr;
            }

        </script>    
    </body>
</html>

